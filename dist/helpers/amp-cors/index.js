"use strict";var e=this&&this.__awaiter||function(i,a,l,c){return new(l||(l=Promise))(function(e,t){function r(e){try{o(c.next(e))}catch(e){t(e)}}function n(e){try{o(c.throw(e))}catch(e){t(e)}}function o(t){t.done?e(t.value):new l(function(e){e(t.value)}).then(r,n)}o((c=c.apply(i,a||[])).next())})},i=this&&this.__generator||function(r,n){var o,i,a,e,l={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(o)throw new TypeError("Generator is already executing.");for(;l;)try{if(o=1,i&&(a=2&t[0]?i.return:t[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,t[1])).done)return a;switch(i=0,a&&(t=[2&t[0],a.value]),t[0]){case 0:case 1:a=t;break;case 4:return l.label++,{value:t[1],done:!1};case 5:l.label++,i=t[1],t=[0];continue;case 7:t=l.ops.pop(),l.trys.pop();continue;default:if(!(a=0<(a=l.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){l=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){l.label=t[1];break}if(6===t[0]&&l.label<a[1]){l.label=a[1],a=t;break}if(a&&l.label<a[2]){l.label=a[2],l.ops.push(t);break}a[2]&&l.ops.pop(),l.trys.pop();continue}t=n.call(r,l)}catch(e){t=[6,e],i=0}finally{o=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}},t=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}},r=this;Object.defineProperty(exports,"__esModule",{value:!0});var n=t(require("koa-router")),o=t(require("nconf"));o.default.env();var a,l=new n.default,c=o.default.get("allowedSourceOrigin")||"https://www.goid.com.sg",u=["https://www.goid.com.sg","https://example-com.cdn.ampproject.org","https://example.com.amp.cloudflare.com","https://cdn.ampproject.org",c];l.all("/",function(n,o){return e(r,void 0,void 0,function(){var t,r;return i(this,function(e){switch(e.label){case 0:return[4,o()];case 1:return e.sent(),t=n.query.__amp_source_origin,r=!1,"true"===n.header["amp-same-origin"]?(a=t,r=!0):u.includes(n.headers.origin)&&(t=c,a=n.headers.origin,r=!0),r&&n.set({"Access-Control-Allow-Credentials":"true","Access-Control-Allow-Origin":a,"Access-Control-Expose-Headers":"AMP-Access-Control-Allow-Source-Origin","AMP-Access-Control-Allow-Source-Origin":t}),[2]}})})}),exports.default=l;